!function(t){window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/.6)};var i=document.getElementById("firework"),e=t("#firework").attr("type")||null,s=i.getContext("2d");function o(t,i){return Math.random()*(i-t)+t}function h(t,i,e,s){var o=t-e,h=i-s;return Math.sqrt(Math.pow(o,2)+Math.pow(h,2))}function n(t,i,e,s){for(this.x=t,this.y=i,this.sx=t,this.sy=i,this.tx=e,this.ty=s,this.distanceToTarget=h(t,i,e,s),this.distanceTraveled=0,this.coordinates=[],this.coordinateCount=3;this.coordinateCount--;)this.coordinates.push([this.x,this.y]);this.angle=Math.atan2(s-i,e-t),this.speed=2,this.acceleration=1.05,this.brightness=o(50,70),this.targetRadius=1,this.sound=new Audio,this.sound.src="/assets/bz.wav"}function a(t,i){for(this.x=t,this.y=i,this.coordinates=[],this.coordinateCount=5;this.coordinateCount--;)this.coordinates.push([this.x,this.y]);this.angle=o(0,2*Math.PI),this.speed=o(1,10),this.friction=.95,this.gravity=1,this.hue=o(hue-20,hue+20),this.brightness=o(50,80),this.alpha=1,this.decay=o(.015,.03)}cw=window.innerWidth,ch=window.innerHeight,fireworks=[],particles=[],hue=120,limiterTotal=5,limiterTick=0,timerTotal=80,timerTick=0,mousedown=!1,mx=0,my=0,i.width=cw,i.height=ch,n.prototype.update=function(t){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.targetRadius<8?this.targetRadius+=.3:this.targetRadius=1,this.speed*=this.acceleration;var i=Math.cos(this.angle)*this.speed,e=Math.sin(this.angle)*this.speed;this.distanceTraveled=h(this.sx,this.sy,this.x+i,this.y+e),this.distanceTraveled>=this.distanceToTarget?(function(t,i){for(var e=30;e--;)particles.push(new a(t,i))}(this.tx,this.ty),fireworks.splice(t,1)):(this.x+=i,this.y+=e)},n.prototype.draw=function(){s.beginPath(),s.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]),s.lineTo(this.x,this.y),s.strokeStyle="hsl("+hue+", 100%, "+this.brightness+"%)",s.stroke(),s.beginPath(),s.arc(this.tx,this.ty,this.targetRadius,0,2*Math.PI),s.stroke()},a.prototype.update=function(t){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.alpha-=this.decay,this.alpha<=this.decay&&particles.splice(t,1)},a.prototype.draw=function(){s.beginPath(),s.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]),s.lineTo(this.x,this.y),s.strokeStyle="hsla("+this.hue+", 100%, "+this.brightness+"%, "+this.alpha+")",s.stroke()},i.addEventListener("mousemove",(function(t){mx=t.pageX-i.offsetLeft,my=t.pageY-i.offsetTop})),i.addEventListener("mousedown",(function(t){t.preventDefault(),mousedown=!0})),i.addEventListener("mouseup",(function(t){t.preventDefault(),mousedown=!1})),window.onload=function t(){requestAnimFrame(t),hue+=.5,s.globalCompositeOperation="destination-out",s.fillStyle="rgba(0, 0, 0, 0.5)",s.fillRect(0,0,cw,ch),s.globalCompositeOperation="lighter";for(var i=fireworks.length;i--;)fireworks[i].draw(),fireworks[i].update(i),"close"==e?fireworks[i].sound.pause():fireworks[i].sound.play();for(i=particles.length;i--;)particles[i].draw(),particles[i].update(i);timerTick>=timerTotal?mousedown||(fireworks.push(new n(cw/2,ch,o(0,cw),o(0,ch/2))),timerTick=0):timerTick++,limiterTick>=limiterTotal?mousedown&&(fireworks.push(new n(cw/2,ch,mx,my)),limiterTick=0):limiterTick++}}(jQuery);